# سجلات النقاط الإيجابية والسلبية

تم تحديث نظام السجلات ليدعم كلاً من سجلات النقاط الإيجابية والسلبية، مع الاحتفاظ برصيد النقاط للطالب طول فترة نشاطه في النظام.

## الميزات الجديدة

1. **سجلات إيجابية وسلبية**: يمكن الآن إنشاء سجلات إيجابية (تزيد من نقاط الطالب) وسجلات سلبية (تنقص من نقاط الطالب).
2. **رصيد النقاط**: يتم تتبع رصيد النقاط الإجمالي للطالب، ويظل هذا الرصيد نشطًا طالما أن الطالب نشط في النظام.
3. **تكامل كروت الحسم**: تم ربط كروت الحسم مع نظام السجلات، حيث يتم إنشاء سجل سلبي تلقائيًا عند إصدار كرت حسم.
4. **عرض مرئي متميز**: تظهر السجلات الإيجابية والسلبية بتنسيقات مختلفة لسهولة التمييز بينها.
5. **تصفية السجلات**: يمكن تصفية السجلات بناءً على نوعها (إيجابي أو سلبي).

## كيفية تشغيل الميزة

1. **تثبيت التغييرات**: قم بتنفيذ الأمر التالي لتطبيق تحديثات قاعدة البيانات:

```bash
npm run migrate
```

يتطلب هذا وجود متغيرات البيئة التالية:
- `SUPABASE_URL`: عنوان URL لقاعدة بيانات Supabase
- `SUPABASE_SERVICE_KEY`: مفتاح الخدمة لقاعدة بيانات Supabase

2. **صفحة سجلات المعلم**: تم تحديث صفحة سجلات المعلم لتتيح إضافة سجلات إيجابية وسلبية.

3. **صفحة كروت الحسم**: تم تحديث صفحة كروت الحسم لإنشاء سجلات سلبية تلقائيًا عند إصدار كرت حسم.

## المكونات التي تم تحديثها

1. `app/student/records/student-records-client.tsx` - مكون عرض السجلات المحدث
2. `app/teacher/records/page.tsx` - صفحة سجلات المعلم
3. `app/teacher/deduction-cards/page.tsx` - صفحة كروت الحسم
4. `supabase/migrations/20231220_add_is_positive_to_user_records.sql` - ملف ترحيل لإضافة حقل `is_positive` لجدول السجلات وإنشاء جدول `user_points`
5. `scripts/run-migrations.js` - سكريبت لتنفيذ ملفات الترحيل

## نظرة على قاعدة البيانات

### جدول `user_records` (تم تحديثه)

تمت إضافة الحقل التالي:
- `is_positive`: قيمة منطقية تشير إلى ما إذا كان السجل إيجابيًا (true) أو سلبيًا (false). القيمة الافتراضية هي true.

### جدول `user_points` (جديد)

تم إنشاء جدول جديد لتخزين رصيد النقاط:
- `id`: معرف فريد
- `user_id`: معرف المستخدم
- `total_points`: إجمالي النقاط
- `positive_points`: إجمالي النقاط الإيجابية
- `negative_points`: إجمالي النقاط السلبية
- `last_updated`: آخر تحديث للنقاط

## مثال على الاستخدام

### إنشاء سجل إيجابي
1. انتقل إلى صفحة سجلات المعلم
2. انقر على "إضافة سجل جديد"
3. اختر "إيجابي" كنوع السجل
4. أدخل البيانات المطلوبة
5. انقر على "إنشاء السجل"

### إنشاء سجل سلبي
1. انتقل إلى صفحة سجلات المعلم
2. انقر على "إضافة سجل جديد"
3. اختر "سلبي" كنوع السجل
4. أدخل البيانات المطلوبة
5. انقر على "إنشاء السجل"

### إنشاء كرت حسم (ينشئ سجلًا سلبيًا تلقائيًا)
1. انتقل إلى صفحة كروت الحسم
2. انقر على "إنشاء كرت جديد"
3. اختر الطالب
4. أدخل عدد النقاط وسبب الحسم
5. انقر على "إنشاء كرت حسم"

## ملاحظات تقنية

- يتم تحديث رصيد النقاط تلقائيًا عن طريق محفزات قاعدة البيانات عند إنشاء أو تحديث أو حذف السجلات.
- تم إنشاء سياسات أمان لضمان أن المستخدمين يمكنهم فقط رؤية رصيد النقاط الخاص بهم.
- جميع التغييرات تتم في وقت حقيقي وتنعكس فورًا في واجهة المستخدم. 